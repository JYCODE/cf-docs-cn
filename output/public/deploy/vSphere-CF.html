<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/deploy/vSphere-CF.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | 安装部署 Cloud Foundry' property='og:title'>
<meta content='在vSphere上通过BOSH工具大规模部署Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | 安装部署 Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<!-- %a{:href => url(@config, :www_app)} -->
<a href='http://www.cloudfoundry.cn'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>注册</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>下载</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>支持</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>状态</a>
</li>
<li>
<a href='http://http://www.cloudfoundry.com' target='_blank'>英文站点</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='http://cndocs.cloudfoundry.com'>技术文档</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/getinvolved"} 如何参与 -->
<a href='http://cn.cloudfoundry.com/getinvolved'>如何参与</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/partners"} 合作伙伴 -->
<a href='http://cn.cloudfoundry.com/partners'>合作伙伴</a>
</li>
<li>
<!-- %a{:href => url(@config, :blog_app)} 中文博客 -->
<a href='http://cnblog.cloudfoundry.com/'>中文博客</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/about"} 关于我们 -->
<a href='http://cn.cloudfoundry.com/about'>关于我们</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Deploy</h1>
<p class='sub-head'>安装部署 Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Cloud Foundry入门</a>
</strong>
迅速开始使用Cloud Foundry的入门文档.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>语言和编程框架</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java入门指南</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala入门指南</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>在Java应用中使用MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>在Java应用中使用PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>在Java应用中使用MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>有关自动配置</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>概述</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>相关事宜</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>安装 Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>创建应用</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>基础架构</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>安装 MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>使用 MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>服务</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>介绍</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>常见问题</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>工具</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>安装</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>应用调试</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>快速参考</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>非交互模式</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott隧道</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>配置</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>应用调试</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>应用部署</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>远程访问</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/spring-insight.html'>Spring Insight</a>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box 集成</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>部署应用</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>部署云平台</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/deploy/overview.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/deploy/dev_setup.html'>dev_setup</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/dev_setup-Single-Node.html'>单节点dev_setup</a>
</li>
<li>
<a href='/deploy/dev_setup-Multi-Node.html'>多节点dev_setup</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/bosh.html'>什么是BOSH</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/bosh-docs.html'>BOSH文档</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/vSphere.html'>在vSphere上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/vSphere-IaaS.html'>准备IaaS环境</a>
</li>
<li>
<a href='/deploy/vSphere-BOSH.html'>安装BOSH</a>
</li>
<li>
<a href='/deploy/vSphere-CF.html'>部署Cloud Foundry</a>
</li>
<li>
<a href='/deploy/vSphere-CF-mgmt.html'>管理和运维Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/OpenStack.html'>在OpenStack上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/os-install.html'>OpenStack Essex安装及配置</a>
</li>
<li>
<a href='/deploy/os-prepare.html'>准备BOSH CLI虚拟机</a>
</li>
<li>
<a href='/deploy/os-micro-bosh.html'>部署Micro BOSH</a>
</li>
<li>
<a href='/deploy/os-bosh.html'>部署BOSH</a>
</li>
<li>
<a href='/deploy/os-cf.html'>部署Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/customize.html'>定制Cloud Foundry</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/customize-framework.html'>添加框架</a>
</li>
<li>
<a href='/deploy/customize-runtime.html'>添加运行时</a>
</li>
<li>
<a href='/deploy/customize-services.html'>添加系统服务</a>
</li>
<li>
<a href='/deploy/customize-php.html'>支持PHP语言</a>
</li>
<li>
<a href='/deploy/customize-python.html'>支持Python语言</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>例子</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>酷炫应用程序</a>
</li>
<li class='js-subtopic'>
<a href='/samples/samples.html'>精彩代码分析</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
常见问题.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
加入讨论.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
学习更多.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>在vSphere上通过BOSH工具大规模部署Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/vSphere" rel="tag">vSphere</a><a href="/tags/BOSH" rel="tag">BOSH</a><a href="/tags/Deploy" rel="tag">Deploy</a><a href="/tags/IaaS" rel="tag">IaaS</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2013-01-14
</span>
</p>
<div id='social-share'></div>
<p>在前面的文章中，我们安装了Micro BOSH和 BOSH。如果一切顺利，我们已经为安装 Cloud Foundry做好准备了。首先，我们为Cloud Foundry的部署制定资源计划。</p>

<p>在我们编写本文时，完整的 Cloud Foundry 安装包含大约 34 个不同作业（虚拟机）。其中有些作业为核心组件，必须安装至少一个这类作业的实例；例如，Cloud Controller、NATS 和 DEA 等。有些作业应具有多个实例，具体取决于实际需求；例如 DEA 和router等。有些作业是可选的，例如服务网关和服务节点。因此，我们在安装 Cloud Foundry 前，应决定将哪些组件纳入部署范围。我们制定了要部署的组件的清单后，便可以规划每个作业所需的资源。通常，这些资源包括 IP 地址、CPU、内存和存储。下面是一个部署计划示例。</p>

<table class="std">
<tr>
<th>作业</th>
      <th>实例数</th>
      <th>IP</th>
      <th>内存</th>
      <th>CPU</th>
      <th>磁盘 (GB)</th>
      <th>是否为必需的？</th>
    </tr>
<tr>
<td>debian_nfs_server</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>2 GB</td>
      <td>2</td>
      <td>16</td>
      <td>必需</td>
    </tr>
<tr>
<td>nats</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>ccdb_postgres</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>uaadb</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>vcap_redis</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>uaa</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>acmdb</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>acm</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>cloud_controller</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>2 GB</td>
      <td>2</td>
      <td>16</td>
      <td>必需</td>
    </tr>
<tr>
<td>stager</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>router</td>
      <td>2</td>
      <td>xx.xx.xx.xx</td>
      <td>512 MB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>health_manager</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>必需</td>
    </tr>
<tr>
<td>dea</td>
      <td>2</td>
      <td>xx.xx.xx.xx</td>
      <td>2 GB</td>
      <td>2</td>
      <td>16</td>
      <td>必需</td>
    </tr>
<tr>
<td>mysql_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>mysql_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>mongodb_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>mongodb_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>redis_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>redis_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>rabbit_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>rabbit_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>postgresql_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>postgresql_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>vblob_node</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>vblob_gateway</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>backup_manager</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>service_utilities</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>serialization_data_server</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>services_nfs</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>syslog_aggregator</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>services_redis</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>opentsdb</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>collector</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>dashboard</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>service_broker</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>hbase_master</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>hbase_slave</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>collector</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>login</td>
      <td>1</td>
      <td>xx.xx.xx.xx</td>
      <td>1 GB</td>
      <td>1</td>
      <td>8</td>
      <td>可选</td>
    </tr>
<tr>
<td>合计：</td>
      <td>41</td>
      <td> </td>
      <td>42 GB</td>
      <td>42</td>
      <td>384</td>
      <td> </td>
    </tr>
</table><p>根据上表，我们便可以确定所需的资源池：</p>

<table class="std">
<tr>
<th>池名称</th>
      <th>规模</th>
      <th>配置</th>
      <th>作业</th>
    </tr>
<tr>
<td>small</td>
      <td>30</td>
      <td>RAM：1 GB；CPU：1 个；磁盘：8 GB</td>
      <td>nats、ccdb_postgres、uaadb、vcap_redis、uaa、acmdb、acm、stager、health_manager、mysql_node、service_broker、hbase_master、hbase_slave、login、mysql_gateway、mongodb_node、mongodb_gateway、redis_node、redis_gateway、postgresql_node、postgresql_gateway、vblob_node、vblob_gateway、backup_manager、service_utilities、serialization_data_server、services_nfs、syslog_aggregator、services_redis、opentsdb、collector、dashboard</td>
    </tr>
<tr>
<td>medium</td>
      <td>4</td>
      <td>RAM：2 GB；CPU：2 个；磁盘：16 GB</td>
      <td>debian_nfs_server、cloud_controller、dea</td>
    </tr>
<tr>
<td>router</td>
      <td>2</td>
      <td>RAM：512 M；CPU：1 个；磁盘：8 GB</td>
      <td>router</td>
    </tr>
</table><p>根据上面两个表，我们可以修改清单文件。</p>

<p>我们将清单文件命名为cf.yml。以下各节详细说明了其中的字段。 完整的Cloud Foundry部署yml文件，请参考：<a href="https://github.com/vmware-china-se/bosh_doc/blob/master/cf.yml">https://github.com/vmware-china-se/bosh_doc/blob/master/cf.yml</a>（注，此yml文件是用来为Cloud Foundry的BOSH部署提供配置信息，与之前介绍的BOSH yml文件不同）</p>

<p><strong>name</strong></p>

<p>这是 Cloud Foundry 部署名。我们可以随意对它命名。</p>

<p><strong>director_uuid</strong></p>

<p>director UUID 是我们部署的 BOSH Director的 UUID。我们可以通过下面的命令来检索此值：</p>

<p><code>$ bosh status</code></p>

<p><strong>release</strong></p>

<p>此Release名称应与您在创建 CF Release时输入的名称相同。版本是在创建Release时自动生成的。</p>

<p><strong>compilation、update、networks、resource_pools</strong></p>

<p>这些字段与 bosh.yml 文件中的那些字段类似。有关更多信息，请参考上一部分。</p>

<p><strong>jobs</strong></p>

<p>作业是 Cloud Foundry 的组件。每个作业在一个虚拟机上运行。各个作业的说明如下。</p>

<table class="std">
<tr>
<th>组件</th>
      <th>说明</th>
    </tr>
<tr>
<td>debian_nfs_server、services_nfs</td>
      <td>这两个作业在 Cloud Foundry 中用作 NFS 服务器。由于它们是文件服务器，因此我们应确保“persistent_disk”属性确实存在。</td>
    </tr>
<tr>
<td>syslog_aggregator</td>
      <td>此作业用于收集系统日志并将它们存储在数据库中。</td>
    </tr>
<tr>
<td>nats</td>
      <td>NATS 是 Cloud Foundry 的消息总线。它是 Cloud Foundry 中的核心组件之一。</td>
    </tr>
<tr>
<td>opentsdb</td>
      <td>这是用来存储日志信息的数据库。由于它是数据库，因此它也需要“persistent_disk”属性。</td>
    </tr>
<tr>
<td>collector</td>
      <td>此作业用于收集系统信息并将它们存储在数据库中。</td>
    </tr>
<tr>
<td>dashboard</td>
      <td>这是基于 Web 的控制台工具，用来监视和报告 Cloud Foundry 平台的情况。</td>
    </tr>
<tr>
<td>cloud_controller、ccdb</td>
      <td>cloud_controller负责控制 Cloud Foundry 的所有组件。“ccdb”是Cloud Controller的数据库。“persistent_disk”属性在ccdb中是必需的。</td>
    </tr>
<tr>
<td>uaa、uaadb</td>
      <td>uaa用于进行用户身份验证和授权。uaadb是用来存储用户信息的数据库。“persistent_disk”属性对uaadb而言是必需的。</td>
    </tr>
<tr>
<td>vcap_redis、services_redis</td>
      <td>这两个作业用于存储 Cloud Foundry 的内部键值对。</td>
    </tr>
<tr>
<td>acm、acmdb</td>
      <td>acm是访问控制管理器 (Access Control Manager) 的简写形式。ACM 是一项服务，借助这项服务，Cloud Foundry 组件可以实现访问控制功能。“acmdb”是acm的数据库。“acmdb”也需要“persistent_disk”属性。</td>
    </tr>
<tr>
<td>stager</td>
      <td>stager 这个作业负责将用户应用程序的源代码及所有必需包打包。暂存完成后，便会将该应用程序传递给dea加以执行。</td>
    </tr>
<tr>
<td>router</td>
      <td>用于将用户的请求路由到 Cloud Foundry 中的正确目标位置。</td>
    </tr>
<tr>
<td>health_manager、health_manager_next</td>
      <td>health_manager这个作业负责监视所有用户的应用程序的运行状况。health_manager_next是health_manager的下一代版本。它们将共存一些时日。</td>
    </tr>
<tr>
<td>dea</td>
      <td>“dea”是 Droplet Execution Agent 的简写形式。所有用户的应用程序都在dea中执行。</td>
    </tr>
<tr>
<td>mysql_node、mysql_gateway、mongodb_node、mongodb_gateway、redis_node、redis_gateway、rabbit_node、rabbit_gateway、postgresql_node、postgresql_gateway、vblob_node、vblob_gateway</td>
      <td>这些作业全都是给 Cloud Foundry提供服务的。每项服务都有一个负责置备资源的节点。对应的网关位于cloud_controller与服务节点之间，担当每项服务的管理功能。</td>
    </tr>
<tr>
<td>backup_manager</td>
      <td>用于备份用户的数据和数据库。</td>
    </tr>
<tr>
<td>service_utilities</td>
      <td>服务管理实用程序。</td>
    </tr>
<tr>
<td>serialization_data_server</td>
      <td>用于在 Cloud Foundry 中对数据进行序列化的服务器。</td>
    </tr>
</table><p><strong>properties：</strong></p>

<p>这是 cf.yml 文件中的另一个重要部分。我们应注意，此节中的 IP 地址应与 jobs 字段中的那些地址要一致。您应将此节中的密码和令牌替换成您自己的安全密码和令牌。</p>

<p>domain：这是供用户访问的域的名称。我们还应创建一个 DNS 服务器来将该域解析为负载均衡器的 IP 地址。在我们的示例中，我们将域名设置为cf.local，以便用户在推送应用程序时可以使用vmc target api.cf.local。</p>

<p>cc.srv_api_uri：此属性通常采用以下格式：<code>http://api.&lt;您的域名&gt;</code>。例如，如果我们将域设置为cf.local，那么srv_api_uri将为 <code>http://api.cf.local</code>。</p>

<p>cc.password：此密码必须包含至少 16 个字符。</p>

<p>cc. allow_registration：如果它为 True，则用户可以使用vmc命令注册帐户。将它设置为 False 则禁止此行为。</p>

<p>cc.admins：管理员用户的名单。即使allow_registration标志设置为 False，管理员用户也可以通过vmc命令进行注册。</p>

<p>这些属性中的大多数“nfs_server”都应设置为“services_nfs”作业的 IP 地址。</p>

<p>mysql_node.production：如果它为 True，则mysql_node的内存必须至少为 4 GB。在试验环境中，我们可以将它设置为 False，这样mysql_node的内存便可以设置为小于 4 GB。</p>

<p>在uaa的properties中jwt.signing_key这段和cc.token_secret这段保留一种就可以了。然后需要注意的是这里的uaa.clients部分指定了其他与UAA有关的组件（比如dashboard）作为client与UAA交互时的验证规则。这一部分不要轻易修改，并且需要保证配置文件中含义相同的secret要前后一致。</p>

<p>由于yml文件可能会随着 Cloud Foundry 新Release的问世而发生演变，因此提供了使用 BOSH 命令验证yml文件的选项。键入“bosh help”后，您便可以看到“bosh diff”的用法和解释：</p>

<p><code>$ bosh diff [&lt;template_file&gt;]</code></p>

<p>此命令会将您当前的部署清单与指定的部署清单模板进行对比。它可更新部署配置文件。最新的开发模板可以在deployment repo 中找到。</p>

<p>例如，您可以运行下面的命令来将yml文件与模板文件进行对比。首先，您必须切换到您的 cf.yml 文件和模板文件所在的目录，然后运行下面的命令：</p>

<p><code>$ bosh diff dev-template.erb</code></p>

<p>此命令将显示 cf.yml 文件中的错误。如果缺少某些字段，此命令将自动帮您填入这些字段。如果有拼写错误或其他错误，此命令将报告存在语法错误。</p>

<p>您可以从以下位置下载部署Cloud Foundry的示例yml文件：</p>

<p><a href="https://github.com/vmware-china-se/bosh_doc/blob/master/cf.yml">https://github.com/vmware-china-se/bosh_doc/blob/master/cf.yml</a></p>

<p>此清单文件完成后，我们就可以开始安装 Cloud Foundry 了。</p>

<p>1) 在之前的步骤中，我们已经通过以下命令从Gerrit克隆了 CF 代码库：</p>

<p><code>$ gerrit clone ssh://&lt;your username&gt;@reviews.cloudfoundry.org:29418/cf-release.git</code></p>

<p>注意：如果您没有SSL证书的话，使用新版vmc是无法进行登陆我们当前的部署环境的。这时我们需要对配置文件和cf-release中的代码做如下两个修改：</p>

<p>1、在Cloud Foundry的部署文件cf-dev.yml中修改login的协议为HTTP：</p>
<pre><code class="language-ruby">    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="n">properties</span><span class="p">:</span>

    <span class="o">.</span><span class="n">.</span><span class="o">.</span>

      <span class="n">login</span><span class="p">:</span>
        <span class="n">protocol</span><span class="p">:</span> <span class="n">http</span>
      
    <span class="o">.</span><span class="n">.</span><span class="o">.</span></code></pre>

<p>2、修改Cloud Controller的配置文件，文件位置：<code>../cf-release/jobs/cloud_controller/templates/cloud_controller.yml.erb</code> </p>

<pre><code class="language-ruby">    <span class="o">&lt;</span><span class="sx">% if </span><span class="n">cc_props</span><span class="o">.</span><span class="n">uaa</span> <span class="o">&amp;&amp;</span> <span class="n">properties</span><span class="o">.</span><span class="n">uaa</span><span class="o">.</span><span class="n">cc</span> <span class="sx">%&gt;</span>
<span class="sx">    uaa:</span>
<span class="sx">        ...</span>
<span class="sx">        url: https://uaa.&lt;%= properties.domain %&gt;</span>
        <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="o">&lt;</span><span class="sx">% else %&gt;</span>
<span class="sx">    uaa:</span>
<span class="sx">        ...</span>
<span class="sx">        url: https://uaa.&lt;%= properties.domain %&gt;</span>
        <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span></code></pre>

<p>把上述两个https改成http。另外：如果您的网络环境比较特殊的话，还可能会出现CloudController在内网中不能通过URL直接解析到UAA的IP，那么您还需要修改下面的源文件和hosts文件：</p>

<p><code>../cf-release/src/cloud_controller/cloud_controller/app/models/uaa_token.rb</code> </p>

<p>把这个文件中所有的 AppConfig[:uaa][:url] 替换为 <code>"http://uaa.&lt;yourdomain&gt;:8080"</code> ，要记得带双引号。</p>

<p>然后在部署完成后CC的虚拟机hosts中添加uaa的URL来帮助内网中进行正确的解析，这一部分会在后面有说明。</p>

<p>2) 切换到cf-release目录，然后创建一个 CF Release，这一部分耗时较长，大概需要几十分钟，请耐心等待。</p>

<p><code>$ cd cf-release</code></p>

<p><code>$ ./update</code></p>

<p><code>$ bosh create release</code> </p>

<p>这将下载部署所需的所有包、blob 数据及其他资源。下载过程将耗费若干分钟，主要取决于网络速度。</p>

<p><strong>注意：</strong></p>

<p>1.如果您编辑了 CF Release中的代码，那么您可能需要在命令 bosh create release 中添加 –force 选项。</p>

<p>2.在运行此命令时系统一定要直接连接Internet。</p>

<p>3.如果您的网络速度慢或者您未与 Internet 建立直接连接，那么您可能需要在一个更好的环境中完成创建Release的操作。您可以在有良好 Internet 连接的机器上使用–with-tarball选项创建此Release。然后，您需要将所生成的 tar 包复制到所需系统。</p>

<p>如果一切都未出问题的话，您可以看到此Release的摘要，大致如下：</p>

<pre><code>Generating manifest...
----------------------
Writing manifest...
Release summary
---------------
Packages
+---------------------------+---------+-------+------------------------------------------+
| Name                      | Version | Notes | Fingerprint                              |
+---------------------------+---------+-------+------------------------------------------+
| sqlite                    | 3       |       | e3e9b61f8cdc2610480c2aa841e89dc0bb1dc9c9 |
| ruby                      | 6       |       | b35a5da6c214d9a97fdd664931bf64987053ad4c |
… …
| debian_nfs_server         | 3       |       | c1dc860ed6ab2bee68172be996f64f9587e9ac0d |
+---------------------------+---------+-------+------------------------------------------+
Jobs
+---------------------------+----------+-------------+------------------------------------------+
| Name                      | Version  | Notes       | Fingerprint                              |
+---------------------------+----------+-------------+------------------------------------------+
| redis_node                | 19       |             | 61098860eaa8cfb5dc438255ebe28db74a1feabc |
| rabbit_gateway            | 13       |             | ddcc0901ded1e45fdc4f318ed4ba8d8ccca51f7f |
… …
| debian_nfs_server         | 7        |             | 234fabc1a2c5dfbfd7c932882d947fed331b8295 |
| memcached_gateway         | 4        |             | 998623d86733a633c789849721e00d85cc3ebc20 |
Jobs affected by changes in this release
+------------------+----------+
| Name             | Version  |
+------------------+----------+
… …
| cloud_controller | 45.1-dev |
+------------------+----------+
Release version:95.10-dev
Release manifest:/home/boshcli/cf-release/dev_releases/cf-def-95.10-dev.yml
</code></pre>

<p>正如您可以看到的那样，dev-releases 目录包含此Release的 yml 清单文件（如果启用了 –with-tarball 选项，则还包含一个 tar 包文件）。</p>

<p>3) 将 BOSH CLI 的目标设为 BOSH 的director。如果您不记得该director的 IP，您可以在第 III 部分中的 BOSH 部署清单中找到它。</p>

<p><code>$ bosh target 10.60.98.117:25555</code></p>

<p><code>Target set to 'bosh_director (http://10.60.98.117:25555) Ver:0.5.1 (release:abb3e7a4 bosh:2c69ee8c)'</code></p>

<p>4) 通过生成的清单(manifest)文件（例如，示例中的 cf-def-95.10-dev.yml）上传 CF Release。</p>

<p><code>$ bosh upload release cf-def-95.10-dev.yml</code></p>

<p>这一步将复制安装包和作业，并将它们构建成一个 tar 包，然后对此Release进行验证以确保文件和依赖项正确无误。验证完毕后，它会上传Release并创建新的作业。最后，会看到Release已上传的信息：</p>

<pre><code>	Task 317 done
	Started		2012-08-28 05:35:43 UTC
	Finished	2012-08-28 05:36:44 UTC
	Duration	00:01:01
	Release uploaded
</code></pre>

<p>您可以通过以下命令验证上传的Release：</p>

<p><code>$ bosh releases</code></p>

<p>您可以查看列表中所有新上传的Release：</p>

<pre><code>	+--------+---------------------------------------------------------------------------+
	| Name   | Versions                                                                                  |
	+--------+----------------------------------------------------------------------------+
	| cf-def | 95.1-dev, 95.8-dev, 95.9-dev, 95.10-dev |
	| cflab  | 92.1-dev                                                                                  |
	+--------+-------------------------------------------------------------------------+
</code></pre>

<p>5) 在我们已经上传了Release和stemcell（就是第 III 部分中的那个stemcell）后，部署清单(deployment manifest)也已准备就绪，那么就将BOSH的部署配置设置为此部署清单吧：</p>

<p><code>$ bosh deployment cf-dev.yml</code></p>

<p>设置完毕：</p>

<p><code>Deployment set to '/home/boshcli/cf-dev.yml'</code></p>

<p>现在我们就可以部署 Cloud Foundry 了，这一部分是最耗时的，根据您的网速情况可能需要1个小时以上甚至两个小时：</p>

<p><code>$ bosh deploy</code></p>

<p>这将为每个作业创建虚拟机、编译包并安装依赖项。此过程将耗费十几分钟到几小时，快慢取决于服务器的硬件条件。您可以看到大致如下的输出：</p>

<pre><code>	Preparing deployment
	binding deployment (00:00:00)                                                                     
	binding releases (00:00:01)                                                                       
	  … …
	Preparing package compilation
	  … …
	Compiling packages
	   … …
	Preparing DNS
	binding DNS (00:00:00)    
	Creating bound missing VMs
	  … …                                                             
	Binding instance VMs
	  … …                                                                      
	Preparing configuration
	binding configuration (00:00:03)                                                                  
	  … …
	Creating job cloud_controller
	cloud_controller/0 (canary) (00:02:45)        
	  … …                                                    
	Done                    1/1 00:08:41                                                                

	Task 318 done
	Started		2012-08-28 05:37:52 UTC
	Finished	2012-08-28 05:49:43 UTC
	Duration	00:11:51
	Deployed 'cf-dev.yml' to 'bosh_director'
</code></pre>

<p>要查看您的部署，可以使用下面的命令：</p>

<p><code>$ bosh deployments</code></p>

<pre><code>	+----------+
	| Name     |
	+----------+
	| cf.local |
	+----------+
	Deployments total: 1
</code></pre>

<p>您还可以验证每个虚拟机的运行状态：</p>

<p><code>$ bosh vms</code></p>

<pre><code>	+-----------------------------+---------+---------------+-------------+
	| Job/index                   | State   | Resource Pool | IPs         |
	+-----------------------------+---------+---------------+-------------+
	| acm/0                       | running | small         | 10.60.98.58 |
	| acmdb/0                     | running | small         | 10.60.98.57 |
	| cloud_controller/0          | running | medium        | 10.60.98.59 |
	 … … …
	+-----------------------------+---------+---------------+-------------+
	VMs total: 40
</code></pre>

<h5 id="section">注意：</h5>

<pre><code>前面提到在缺少SSL证书且网络环境比较特殊的情况下还需要修改Cloud Controller的hosts文件来使uaa的URL能够正确解析：

登录到所有CloudController的虚拟机中，在他们的hosts中添加这样一行即可：

&lt;IP_of_uaa&gt; uaa.&lt;yourdomain&gt;
</code></pre>

<p>到这里，Cloud Foundry 已经完全安装好了。如果您迫不及待地想要验证此安装，您可以使用vmc命令将其中一个router的 IP 地址设为目标，然后在该目标上部署一个测试用的 Web 应用程序（见后一节）。由于此时没有配置 DNS 服务，因此，在vmc客户端以及运行浏览器来测试的机器的 hosts 文件需包含至少以下两行内容：</p>

<pre><code>	&lt;router的 IP 地址&gt;  api.yourdomain.com  
	&lt;router的 IP 地址&gt;  &lt;youapp&gt;.yourdomain.com  
</code></pre>

<p>如果上述测试顺利通过，则说明您的 Cloud Foundry 实例正常工作。最后要做的是部署负载均衡器和 DNS服务。它们不属于 Cloud Foundry 的组件，但在生产环境中往往需要正确地设置它们。我们简要地介绍一下如何设置。</p>

<p>您可以部署一个硬件或软件负载均衡器 (LB) 来均匀地向多个router实例分配负载。在我们的示例部署中，我们有两个router。对于软件 LB，您可以使用Stingray 流量管理器。可从以下位置下载该软件：<a href="https://support.riverbed.com/download.htm?filename=public/software/stingray/trafficmanager/9.0/ZeusTM_90_Linux-x86_64.tgz">https://support.riverbed.com/download.htm?filename=public/software/stingray/trafficmanager/9.0/ZeusTM<em>90_Linux-x86</em>64.tgz</a></p>

<p>要解析 Cloud Foundry 实例所属的域名，需要有 DNS 服务器。基本而言，DNS 服务器会将像 *.yourdomain.com 这样带通配符的域名解析为负载均衡器的 IP 地址。如果您没有 LB，您可以设置 DNS Rotation，从而以循环方式将域解析为各个router的地址。</p>

<p>LB 和 DNS 设置妥善后，您便可以开始在您的实例上部署应用程序。</p>

<p>VMC 是使用Cloud Foundry的命令行工具。它可以执行 Cloud Foundry 上的大多数操作，例如配置应用程序、将应用部署到 Cloud Foundry 以及监控应用程序的状态。要安装 VMC，需要先安装 Ruby 和RubyGems（ Ruby Gem管理器）。目前支持 Ruby 1.8.7 和 1.9.2。接着，您可以通过下面的命令安装 VMC（有关 VMC 安装的更多信息，请参见<a href="http://docs.cloudfoundry.com/tools/vmc/installing-vmc.html">http://docs.cloudfoundry.com/tools/vmc/installing-vmc.html</a>）：</p>

<p><code>$ sudo gem install vmc</code></p>

<p>现在，可指定该 Cloud Foundry 实例的目标，相应的 URL 应形如 api.yourdomain.com，例如：</p>

<p><code>$ vmc target api.cf.local</code></p>

<p>使用管理员用户和密码（部署清单中指定了该凭据）登录：</p>

<p><code>$ vmc login</code></p>

<p>起初，系统将要求您为自己的帐户设置密码。登录后，您可以获得自己 Cloud Foundry 实例的信息：</p>

<p><code>$ vmc info</code></p>

<p>现在，我们来创建并部署一个简单的 Hello World Sinatra 应用程序以验证该实例。</p>

<pre><code>$ mkdir ~/hello
$ cd ~/hello
</code></pre>

<p>创建一个名为hello.rb且包含以下内容的 Ruby 文件：</p>

<pre><code>require 'sinatra'
get '/' do
  "Hello from Cloud Foundry"
end
</code></pre>

<p>保存此文件，接下来我们要上传此应用程序：</p>

<p><code>$ vmc push</code></p>

<p>回答提示问题，如下所示</p>

<pre><code>	Would you like to deploy from the current directory?[Yn]: 
	Application Name:hello
	Detected a Sinatra Application, is this correct?[Yn]: 
	Application Deployed URL [hello.cf.local]: 
	Memory reservation (128M, 256M, 512M, 1G, 2G) [128M]: 
	How many instances? [1]: 
	Bind existing services to 'hello'?[yN]: 
	Create services to bind to 'hello'?[yN]: 
	Would you like to save this configuration?[yN]: 
</code></pre>

<p>稍等片刻后，您将看到以下内容：</p>

<pre><code>	Creating Application:OK
	Uploading Application:
	Checking for available resources:OK
	Packing application:OK
	Uploading (0K):OK   
	Push Status:OK
	Staging Application 'hello':OK                                                 
	Starting Application 'hello':OK   
</code></pre>

<p>现在，到浏览器中访问该应用程序的 URL：hello.cf.local。如果您可以看到下面的文本，则说明您的应用程序已成功部署。</p>

<p><img src="/images/deploy/fig27.png" alt="fig27.png"></p>

<p>恭喜！您的 Cloud Foundry 实例已经完全设置好了。它在功能上与 cloudfoundry.com 完全相同。</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://e.weibo.com/2169336083/profile' rel='external' target='_blank'>Weibo</a>
<a class='facebook replaced' href='http://cloudfoundry.csdn.net' rel='external' target='_blank'>CSDN</a>
<a class='youtube replaced' href='http://i.youku.com/u/id_UNDI5MTA2Mjk2' rel='external' target='_blank'>YouKu</a>
</div>
<div class='prepend-2 span-5'>
<p>
<!-- %a{:href => "#{url(@config, :www_app)}/faq"} 问题 -->
<a href='http://cndocs.cloudfoundry.com/faq.html'>问题</a>
|
<a href='http://forum.csdn.net/slist/cloudfoundry' rel='external'>论坛</a>
|
<!-- %a{:href => url(@config, :blog_app), :rel => "external"} 博客 -->
<a href='http://cnblog.cloudfoundry.com/' rel='external'>博客</a>
|
<a href='http://www.cloudfoundry.com/jobs'>工作</a>
|
<a href='http://www.cloudfoundry.com/legal'>法律</a>
|
<a href='http://www.cloudfoundry.com/terms'>条款</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>隐私</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2013 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-14']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    /$(document).ready(function() {
     / $('#social-share').dcSocialShare({
      /  buttonSize: 'horizontal',
      / buttons: 'facebook,twitter,plusone,linkedin',
      /  location: 'top',
      /  align: 'right',
      /  offsetLocation: 260,
      /  offsetAlign: 100,
      /  width: 80,
      /  center: true,
      /  centerPx: 600,
      /  disableFloat: true,
      /  tabText: '',
      /  twitterId: 'cloudfoundry'
      /});
    /});
  //]]>
</script>
</body>
</html>
