<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/deploy/os-install.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | OpenStack Essex安装与配置' property='og:title'>
<meta content='在OpenStack上通过BOSH工具大规模部署Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | OpenStack Essex安装与配置</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<!-- %a{:href => url(@config, :www_app)} -->
<a href='http://www.cloudfoundry.cn'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>注册</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>下载</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>支持</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>状态</a>
</li>
<li>
<a href='http://http://www.cloudfoundry.com' target='_blank'>英文站点</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='http://cndocs.cloudfoundry.com'>技术文档</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/getinvolved"} 如何参与 -->
<a href='http://cn.cloudfoundry.com/getinvolved'>如何参与</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/partners"} 合作伙伴 -->
<a href='http://cn.cloudfoundry.com/partners'>合作伙伴</a>
</li>
<li>
<!-- %a{:href => url(@config, :blog_app)} 中文博客 -->
<a href='http://cnblog.cloudfoundry.com/'>中文博客</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/about"} 关于我们 -->
<a href='http://cn.cloudfoundry.com/about'>关于我们</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Deploy</h1>
<p class='sub-head'>OpenStack Essex安装与配置</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Cloud Foundry入门</a>
</strong>
迅速开始使用Cloud Foundry的入门文档.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>语言和编程框架</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java入门指南</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala入门指南</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>在Java应用中使用MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>在Java应用中使用PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>在Java应用中使用MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>有关自动配置</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>概述</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>相关事宜</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>安装 Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>创建应用</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>基础架构</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>安装 MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>使用 MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>服务</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>介绍</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>常见问题</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>工具</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>安装</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>应用调试</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>快速参考</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>非交互模式</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott隧道</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>配置</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>应用调试</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>应用部署</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>远程访问</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/spring-insight.html'>Spring Insight</a>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box 集成</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>部署应用</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>部署云平台</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/deploy/overview.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/deploy/dev_setup.html'>dev_setup</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/dev_setup-Single-Node.html'>单节点dev_setup</a>
</li>
<li>
<a href='/deploy/dev_setup-Multi-Node.html'>多节点dev_setup</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/bosh.html'>什么是BOSH</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/bosh-docs.html'>BOSH文档</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/vSphere.html'>在vSphere上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/vSphere-IaaS.html'>准备IaaS环境</a>
</li>
<li>
<a href='/deploy/vSphere-BOSH.html'>安装BOSH</a>
</li>
<li>
<a href='/deploy/vSphere-CF.html'>部署Cloud Foundry</a>
</li>
<li>
<a href='/deploy/vSphere-CF-mgmt.html'>管理和运维Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/OpenStack.html'>在OpenStack上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/os-install.html'>OpenStack Essex安装及配置</a>
</li>
<li>
<a href='/deploy/os-prepare.html'>准备BOSH CLI虚拟机</a>
</li>
<li>
<a href='/deploy/os-micro-bosh.html'>部署Micro BOSH</a>
</li>
<li>
<a href='/deploy/os-bosh.html'>部署BOSH</a>
</li>
<li>
<a href='/deploy/os-cf.html'>部署Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/customize.html'>定制Cloud Foundry</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/customize-framework.html'>添加框架</a>
</li>
<li>
<a href='/deploy/customize-runtime.html'>添加运行时</a>
</li>
<li>
<a href='/deploy/customize-services.html'>添加系统服务</a>
</li>
<li>
<a href='/deploy/customize-php.html'>支持PHP语言</a>
</li>
<li>
<a href='/deploy/customize-python.html'>支持Python语言</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>例子</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>酷炫应用程序</a>
</li>
<li class='js-subtopic'>
<a href='/samples/samples.html'>精彩代码分析</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
常见问题.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
加入讨论.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
学习更多.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>在OpenStack上通过BOSH工具大规模部署Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/OpenStack" rel="tag">OpenStack</a><a href="/tags/BOSH" rel="tag">BOSH</a><a href="/tags/Deploy" rel="tag">Deploy</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2013-01-30
</span>
</p>
<div id='social-share'></div>
<p>本文档所讲述的方法和步骤与在vSphere上部署很相似，区别仅仅在于本文档中关于OpenStack的一些配置与vSphere不同，在vSphere上部署Cloud Foundry可参考这篇文档：</p>

<p><a href="vSphere.html">在vSphere上通过BOSH工具大规模部署Cloud Foundry</a></p>

<p>按照本文档进行部署时，可将上述文档作为参考和补充之用。</p>

<h3 id="openstack">OpenStack安装</h3>
<p>本文档以OpenStack Essex版本为基础讲解，如果在Folsom上部署，过程也基本相同，不同点只在于网络quantum的管理，特别是floating ip的生成与释放和private sub_net的创建，对于OpenStack Folsom版，本文档同样适用。</p>

<p>关于OpenStack Essex的安装，Openstack官方有很多引导教程，你可以采用适合自己的安装方法，也可以在原来已经安装好的Openstack里划出一部分资源来安装Cloud Foundry，在本示例文档所采用的环境中，我们跟据以下文档安装了一个双节点的Openstack环境：</p>

<p><a href="http://docs.openstack.org/essex/openstack-compute/starter/content/">OpenStack官方文档</a></p>

<p>按照以上教程安装到第2节结束即可。
我们使用了两台服务器分别作为两个节点，这两台服务器的配置如下：</p>

<table class="std">
<tr>
<th>Name</th>
      <th>Role</th>
      <th>Physical CPU</th>
      <th>Physical Memory</th>
      <th>Nic</th>
      <th>Management IP Address</th>
    </tr>
<tr>
<td>Server1</td>
      <td>Controller+Compute</td>
      <td>8 Cores</td>
      <td>16GB</td>
      <td>eth0: floating eth1: private</td>
      <td>10.40.97.30</td>
    </tr>
<td>Server2</td>
      <td>Compute</td>
      <td>8 Cores</td>
      <td>16GB</td>
      <td>eth0: floating eth1: private</td>
      <td>10.40.97.31</td>
    
</table><p>每台服务器有两张网卡，以OpenStack的概念来说，其中eth0专门用作floating ip，eth1专门用作private ip。eth0的IP地址如上表最后一列所示，这个IP 地址在下面的nova配置文件中会用到。</p>

<h3 id="openstack-1">OpenStack配置</h3>
<p>根据以上教程，在此环境中最重要的就是nova.conf这个文件的配置，在我们的环境中，server1的/etc/nova/nova.conf配置如下：</p>

<pre><code>--dhcpbridge_flagfile=/etc/nova/nova.conf
--dhcpbridge=/usr/bin/nova-dhcpbridge
--logdir=/var/log/nova
--state_path=/var/lib/nova
--lock_path=/run/lock/nova
--allow_admin_api=true
--use_deprecated_auth=false
--auth_strategy=keystone
--scheduler_driver=nova.scheduler.simple.SimpleScheduler
--max_cores=256
--max_gigabytes=1000000
--skip_isolated_core_check=true
--s3_host=10.40.97.30
--ec2_host=10.40.97.30
--rabbit_host=10.40.97.30
--cc_host=10.40.97.30
--nova_url=http://10.40.97.30:8774/v1.1/
--routing_source_ip=10.40.97.30
--glance_api_servers=10.40.97.30:9292
--image_service=nova.image.glance.GlanceImageService
--iscsi_ip_prefix=192.168.4
--sql_connection=mysql://novadbadmin:novasecret@10.40.97.30/nova
--ec2_url=http://10.40.97.30:8773/services/Cloud
--keystone_ec2_url=http://10.40.97.30:5000/v2.0/ec2tokens
--api_paste_config=/etc/nova/api-paste.ini
--libvirt_type=kvm
--libvirt_use_virtio_for_bridges=true
--start_guests_on_host_boot=true
--resume_guests_state_on_host_boot=true
# vnc specific configuration
--novnc_enabled=true
--novncproxy_base_url=http://10.40.97.30:6080/vnc_auto.html
--vncserver_proxyclient_address=10.40.97.30
--vncserver_listen=10.40.97.30
# network specific settings
--network_manager=nova.network.manager.FlatDHCPManager
--public_interface=eth0
--flat_interface=eth1
--flat_network_bridge=br100
--fixed_range=192.168.4.1/24
--floating_range=10.40.97.1/24
--network_size=256
--flat_network_dhcp_start=192.168.4.2
--flat_injected=False
--force_dhcp_release
--iscsi_helper=tgtadm
--connection_type=libvirt
--root_helper=sudo nova-rootwrap
--verbose
</code></pre>

<p>请把其中所有的IP地址替换为您自己的IP。在这里，以10开头的地址为floating ip的地址，以192.168开头的地址为private ip地址。</p>

<p>上述配置与官方文档不同的是，在上述配置文件中，我们添加了三行：</p>

<pre><code>--max_cores=256
--max_gigabytes=1000000
--skip_isolated_core_check=true
</code></pre>

<p>添加这三行的目的是，提升OpenStack对虚拟机CPU数和内存问题的限制，当然，以上这两行的值也可以根据实际的部署情况增加。max_cores参数的意义是整个环境中所允许的虚拟CPU的数量，应该改得大一些，以支撑所有的Cloud Foundry虚拟机，否则部署Cloud Foundry会失败。max_gigabytes为总的内存使用限制量，也应该改得足够大。skip_isolated_core_chec参数的意义是跳过虚拟CPU在物理CPU上分配的检查，在小环境里，最好设置为true。</p>

<p>另外，官方文档中说这两台服务器的/etc/nova/nova.conf文件完全相同。但是经我们测试，每一台服务器的vnc配置都不相同，所以，在server2上，编辑/etc/nova/nova.conf文件，修改vnc的部分为：</p>

<pre><code># vnc specific configuration
--novnc_enabled=true
--novncproxy_base_url=http://10.40.97.31:6080/vnc_auto.html
--vncserver_proxyclient_address=10.40.97.31
--vncserver_listen=10.40.97.31
</code></pre>

<p>也就是说，其中的IP地址改为server2的IP地址，其余配置与server1完全一样。</p>

<p>另外，OpenStack为了安全，限制了REST接口发送和接收的速率，为了快速部署的方便，在server1和server2这两台服务器均进行以下修改：
打开/etc/nova/api-paste.ini文件
找到下面两行</p>

<pre><code>[filter:ratelimit]
paste.filter_factory = nova.api.openstack.compute.limits:RateLimitingMiddleware.factory
</code></pre>

<p>紧接着这两行下面，添加一行：</p>

<pre><code>limits=(POST, "*", .*, 9999, MINUTE);(POST, "*/servers", ^/servers, 9999, DAY);(PUT, "*", .*, 9999, MINUTE);(GET, "*changes-since*", .*changes-since.*, 9999, MINUTE);(DELETE, "*", .*, 9999, MINUTE)
</code></pre>

<p>为了保险，可重启两台服务器。</p>

<p>至此，OpenStack的安装结束。按官方文档所述，运行以下命令，如果出现如下结果，说明安装正确：</p>

<p><code>$ sudo nova-manage service list</code></p>

<pre><code>Binary           Host              Zone             Status     State   Updated_At
nova-scheduler   server1           nova             enabled    :-)     2013-01-16 08:05:23
nova-consoleauth server1          nova             enabled    :-)     2013-01-16 08:05:23
nova-compute     server1           nova             enabled    :-)     2013-01-16 08:05:27
nova-network     server1            nova             enabled    :-)     2013-01-16 08:05:23
nova-cert        server1             nova             enabled    :-)     2013-01-16 08:05:23
nova-volume      server1            nova             enabled    :-)     2013-01-16 08:05:23
nova-compute     server2           nova             enabled    :-)     2013-01-16 08:05:13
</code></pre>

<h3 id="cloud-foundry">Cloud Foundry安装准备</h3>

<p>首先，我们需要准备一台ubuntu 12.04机器作为客户端，用于向OpenStack的管理器发送命令，这台客户端可由您随意创建，在个人PC上创建一台ubuntu虚拟机即可。
创建文件~/osrc，编辑文件如下：</p>

<pre><code>export SERVICE_ENDPOINT="http://10.40.97.30:35357/v2.0"
export SERVICE_TOKEN=admin
export SERVICE_TOKEN=admin
export OS_TENANT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=admin
export OS_AUTH_URL="http:// 10.40.97.30:5000/v2.0/"
export SERVICE_ENDPOINT=http:// 10.40.97.30:35357/v2.0
</code></pre>

<p>其中IP地址为您server1的IP，再运行命令：</p>

<p><code>$ source ~/osrc</code></p>

<p>此时就可以在这台客户机上向OpenStack发送命令了。</p>

<p>Cloud Foundry的安装需要Ubuntu 10.04 LTS 64bit的虚拟机。在上述OpenStack官方文档中，它说需要一台Client机器自己制作虚拟机镜像。其实在Ubuntu的官方网站上，有专门为云计算环境提供的一些公共镜像，地址为：</p>

<p><a href="http://cloud-images.ubuntu.com/">http://cloud-images.ubuntu.com/</a></p>

<p>所以，找到Ubuntu12.04的镜像，我们可以采用如下方式添加镜像：</p>

<p><code>$ glance add name="ubuntu 10.04 LTS" disk_format=ami container_format=ami is_public=true \</code>
<code>location=http://cloud-images.ubuntu.com/lucid/current/lucid-server-cloudimg-amd64-disk1.img</code></p>

<p>如果没有错误，将返回如下结果：</p>

<pre><code>Added new image with ID: 97753009-8cb2-4c59-adc1-b3c6d1bc3f56
</code></pre>

<p>在OpenStack的安装里，默认只有5种Flavors，我们需要根据Cloud Foundry需求，创建适合自己部署环境的Flavor。OpenStack安装好以后，Dashboard就可以使用了，在浏览器中直接输入server1的IP地址即可访问，默认的用户名和密码为admin和admin。登录以后，进行如下所示操作：</p>

<p><img src="/images/deploy/fig32-1.png" alt="fig32-1.png"></p>

<p>切换到admin管理界面，选择Flavor Tab， 点击Create Flavor，出现如下选项，我们创建一种名为m1.micro的Flavor，用于我们实验中的所有虚拟机（编译除外），各项参数如下。在实际生产环境中，内存和CPU当然不可能这么小，可根据实际需要填写合适的值。并且，对于不同的虚拟机，需要创建不同的Flavors。</p>

<p><img src="/images/deploy/fig33.png" alt="fig33.png"></p>

<p>另外，我们再创建一个Flavor，专门用来进行编译工作，我们命名为m1.compile，编译需要的资源要大一些，所以我们选择4个CPU和4G内存：</p>

<p><img src="/images/deploy/fig34.png" alt="fig34.png"></p>

<p>另外，我们还创建了一个flavor，命名为m1.inception，专门用作BOSH CLI(Command Line Interface)之用，它的配置为2个CPU，2G内存，50G硬盘。</p>

<p>为了安全，OpenStack的安全组默认禁止了所有的端口通信，在我们测试全程中，我们手动开启了所有端口，过程如下，首先在Dashboard里找到左侧的Access &amp; Security选项卡：</p>

<p><img src="/images/deploy/fig35.png" alt="fig35.png"></p>

<p>在右侧找到Security Groups配置，选择Edit Rules：</p>

<p><img src="/images/deploy/fig36.png" alt="fig36.png"></p>

<p>在测试环境中，我们允许所有的端口进行通信，而默认的OpenStack配置是关闭了所有的端口，所以，我们需要删除其中的所有默认规则，自己创建以下规则，打开所有端口：</p>

<p><img src="/images/deploy/fig37.png" alt="fig37.png"></p>

<p>在OpenStack默认安装中，对每一个工程的限额（Quotas)很低，我们需要提高默认限额，按照如下方法：</p>

<p><img src="/images/deploy/fig38.png" alt="fig38.png"></p>

<p>切换到admin界面，找到左侧的Projects，在右侧找到admin这个工程，选择Edit Project-&gt;Modify Quotas，结果如下：</p>

<p><img src="/images/deploy/fig39.png" alt="fig39.png"></p>

<p>其中，每一项的值代表每一项资源的上限额度，每一项的值可根据需要调整到合适的值。在我们示例中，为了避免不必要的麻烦，我们选择了远远高于实际所需要的上限。</p>

<p>下一步的工作就是创建必要的floating ip池。在本次示例中，我们选择了最小化的Cloud Foundry安装，并没有安装所有的Cloud Foundry组件，尽管如此，也仍然需要大约25个floating ip。如果按照以上官方教程安装OpenStack，那么floating ip pool已经创建好了。我们只需要从池中分配出floating ip即可。</p>

<p>在Dashboard里，可通过如下方式创建floating ip：</p>

<p><img src="/images/deploy/fig40.png" alt="fig40.png"></p>

<p>切换到Project选项卡，选择admin，再选择Access &amp; Security，点击右侧的Allocate IP To Project，即可分配一个floating ip。</p>

<p>也可以在客户端，通过一个shell循环，分配所需要的所有floating ip:</p>

<p><code>$ i=0</code></p>

<p><code>$ while(($i&lt;25))</code></p>

<p><code>&gt; do</code></p>

<p><code>&gt; nova floating-ip-create</code></p>

<p><code>&gt; i=$(($i+1))</code></p>

<p><code>&gt; done</code></p>

<p>最后，我们还需要创建一个默认的key文件 。同样在Dashboard的以上Access &amp; Security选项卡中，有创建密钥对的选项：</p>

<p><img src="/images/deploy/fig41.png" alt="fig41.png"></p>

<p>输入我们第一个密钥名字”mykey”，点击Create Keypair，浏览器会自动下载创建好的密钥的私钥mykey.pem，请妥善保存此私钥，在以后登录虚拟机时也可能用到此私钥：</p>

<p><img src="/images/deploy/fig42.png" alt="fig42.png"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://e.weibo.com/2169336083/profile' rel='external' target='_blank'>Weibo</a>
<a class='facebook replaced' href='http://cloudfoundry.csdn.net' rel='external' target='_blank'>CSDN</a>
<a class='youtube replaced' href='http://i.youku.com/u/id_UNDI5MTA2Mjk2' rel='external' target='_blank'>YouKu</a>
</div>
<div class='prepend-2 span-5'>
<p>
<!-- %a{:href => "#{url(@config, :www_app)}/faq"} 问题 -->
<a href='http://cndocs.cloudfoundry.com/faq.html'>问题</a>
|
<a href='http://forum.csdn.net/slist/cloudfoundry' rel='external'>论坛</a>
|
<!-- %a{:href => url(@config, :blog_app), :rel => "external"} 博客 -->
<a href='http://cnblog.cloudfoundry.com/' rel='external'>博客</a>
|
<a href='http://www.cloudfoundry.com/jobs'>工作</a>
|
<a href='http://www.cloudfoundry.com/legal'>法律</a>
|
<a href='http://www.cloudfoundry.com/terms'>条款</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>隐私</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2013 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-14']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    /$(document).ready(function() {
     / $('#social-share').dcSocialShare({
      /  buttonSize: 'horizontal',
      / buttons: 'facebook,twitter,plusone,linkedin',
      /  location: 'top',
      /  align: 'right',
      /  offsetLocation: 260,
      /  offsetAlign: 100,
      /  width: 80,
      /  center: true,
      /  centerPx: 600,
      /  disableFloat: true,
      /  tabText: '',
      /  twitterId: 'cloudfoundry'
      /});
    /});
  //]]>
</script>
</body>
</html>
