<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/ruby-cf.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby、Rails 和 Cloud Foundry' property='og:title'>
<meta content='Ruby、Rails 和 Cloud Foundry 相关事宜' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby、Rails 和 Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<!-- %a{:href => url(@config, :www_app)} -->
<a href='http://www.cloudfoundry.cn'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>注册</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>下载</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>支持</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>状态</a>
</li>
<li>
<a href='http://http://www.cloudfoundry.com' target='_blank'>英文站点</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='http://cndocs.cloudfoundry.com'>技术文档</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/getinvolved"} 如何参与 -->
<a href='http://cn.cloudfoundry.com/getinvolved'>如何参与</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/partners"} 合作伙伴 -->
<a href='http://cn.cloudfoundry.com/partners'>合作伙伴</a>
</li>
<li>
<!-- %a{:href => url(@config, :blog_app)} 中文博客 -->
<a href='http://cnblog.cloudfoundry.com/'>中文博客</a>
</li>
<li>
<!-- %a{:href => "#{url(@config, :www_app)}/about"} 关于我们 -->
<a href='http://cn.cloudfoundry.com/about'>关于我们</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby、Rails 和 Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Cloud Foundry入门</a>
</strong>
迅速开始使用Cloud Foundry的入门文档.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>语言和编程框架</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java入门指南</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala入门指南</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>在Java应用中使用MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>在Java应用中使用PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>在Java应用中使用MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>有关自动配置</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>概述</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>相关事宜</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>安装 Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>创建应用</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>基础架构</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>安装 MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>使用 MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>服务</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>介绍</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>常见问题</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>工具</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>安装</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>应用调试</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>快速参考</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>非交互模式</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott隧道</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>配置</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>应用调试</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>应用部署</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>远程访问</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/spring-insight.html'>Spring Insight</a>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box 集成</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>部署应用</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>部署云平台</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/deploy/overview.html'>概述</a>
</li>
<li class='js-subtopic'>
<a href='/deploy/dev_setup.html'>dev_setup</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/dev_setup-Single-Node.html'>单节点dev_setup</a>
</li>
<li>
<a href='/deploy/dev_setup-Multi-Node.html'>多节点dev_setup</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/bosh.html'>什么是BOSH</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/bosh-docs.html'>BOSH文档</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/vSphere.html'>在vSphere上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/vSphere-IaaS.html'>准备IaaS环境</a>
</li>
<li>
<a href='/deploy/vSphere-BOSH.html'>安装BOSH</a>
</li>
<li>
<a href='/deploy/vSphere-CF.html'>部署Cloud Foundry</a>
</li>
<li>
<a href='/deploy/vSphere-CF-mgmt.html'>管理和运维Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/OpenStack.html'>在OpenStack上部署</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/os-install.html'>OpenStack Essex安装及配置</a>
</li>
<li>
<a href='/deploy/os-prepare.html'>准备BOSH CLI虚拟机</a>
</li>
<li>
<a href='/deploy/os-micro-bosh.html'>部署Micro BOSH</a>
</li>
<li>
<a href='/deploy/os-bosh.html'>部署BOSH</a>
</li>
<li>
<a href='/deploy/os-cf.html'>部署Cloud Foundry</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/deploy/customize.html'>定制Cloud Foundry</a>
<ul class='js-subguides'>
<li>
<a href='/deploy/customize-framework.html'>添加框架</a>
</li>
<li>
<a href='/deploy/customize-runtime.html'>添加运行时</a>
</li>
<li>
<a href='/deploy/customize-services.html'>添加系统服务</a>
</li>
<li>
<a href='/deploy/customize-php.html'>支持PHP语言</a>
</li>
<li>
<a href='/deploy/customize-python.html'>支持Python语言</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>例子</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>酷炫应用程序</a>
</li>
<li class='js-subtopic'>
<a href='/samples/samples.html'>精彩代码分析</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
常见问题.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
加入讨论.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
学习更多.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby、Rails 和 Cloud Foundry 相关事宜</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/bundler" rel="tag">bundler</a><a href="/tags/Gemfile" rel="tag">Gemfile</a><a href="/tags/git" rel="tag">git</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-28
</span>
</p>
<div id='social-share'></div>
<p>本文提供在 Cloud Foundry 上构建 Ruby 应用程序时的有用提示。
许多最初的限制现在已不再存在。
要查看关于 Ruby 支持的最新消息，请访问：
<a href="http://blog.cloudfoundry.com/tag/ruby/">http://blog.cloudfoundry.com/tag/ruby/</a></p>

<p>下面要介绍的重点主题如下：</p>

<ul>
<li>您的应用程序必须提供一个指定所有必要的 gem 的 <code>Gemfile</code>
</li>
  <li>您的应用程序经过最大程度的预打包</li>
  <li>支持 Ruby 1.8 和 Ruby 1.9</li>
</ul><h2 id="gem-">Gem 和库</h2>

<p>关于 Gem 和 Gemfile 的重要注释：</p>

<p>GEM 列表完整性 － 与 Cloud Foundry 交互的正确方式是提供完整的 <code>Gemfile</code>，
并且每次使用 Gemfile 和运行 
任何 <code>vmc push</code> 或 <code>vmc update</code> 命令前还要运行 <code>bundle install;bundle package</code>。</p>

<p>受支持的使用 gem 的方式是通过 <a href="http://gembundler.com/">捆绑程序</a>
VCAP <strong>不支持</strong>捆绑程序 <a href="https://github.com/jbarnette/isolate">Isolate</a> 以外的其他方法。</p>

<p><strong>您的应用程序必须提供一个指定所有必要 gem 的 <code>Gemfile</code> 和一个特定 gem 版本的 <code>Gemfile.lock</code></strong></p>

<p>有关 <code>bundle package</code> 的详细信息，请参见 <a href="http://gembundler.com/bundle_package.html">http://gembundler.com/bundle_package.html</a></p>

<h2 id="bundler">捆绑程序(Bundler)</h2>

<p>通常应注意复杂难懂的捆绑设置。
虽然 VCAP 会尽最大努力处理您的配置，但也有可能编写的 
Gemfile 无法满足要求，例如同时请求旧版本的 Rails 和全新版本的 Rack 时。
这样的组合请求会立即失败，因而您不必等到把应用程序推送到云后才知道
出了问题。同样道理，版本太过不清楚的 Gemfile 和 Gem 也可以进行创建。</p>

<p>Gemfile 可连同发布的 gem 一起通过 URL、分支名称等引用 git repo。而且捆绑程序会通过专门机制对其进行构建。
<strong>VCAP 现在支持通过 git URL 读取 Gemfile。</strong></p>

<p>示例 <code>Gemfile</code>：</p>

<pre><code class="language-ruby"><span class="n">source</span> <span class="ss">:rubygems</span>

<span class="c1"># Gets the json gem from rubygems</span>
<span class="n">gem</span> <span class="s2">"json"</span><span class="p">,</span> <span class="s2">"~&gt; 1.4.6"</span>

<span class="c1"># Gets the vcap_services_base gem from cloudfoundry's vcap-services-base repo on github.com at master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>

<span class="c1"># Gets the vcap_logging gem from cloudfoundry's common repo on github.com at the specified ref on the master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>

<span class="c1"># Gets the eventmachine from cloudfoundry eventmachine repo on github.com using the release-0.12.11-cf branch</span>
<span class="n">gem</span> <span class="s1">'eventmachine'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/eventmachine.git'</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">'release-0.12.11-cf'</span></code></pre>

<p>只有路径与您的应用程序相关且路径中已构建 gem 时，才可以使用路径来链接到 gem。</p>

<ul>
<li>gem :path =&gt; “some/path”</li>
</ul><p>请注意现在已同时支持平台和 git URL。这样，您就可以在诸如 Windows 环境中工作，
并在您的应用程序开始运行时使用更多不必在 Cloud Foundry 上安装的 gem。</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'vcap_common'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/common'</span><span class="p">,</span> <span class="s1">'vcap/component'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-common.git'</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>
<span class="n">gem</span> <span class="s1">'warden-client'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'warden/client'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/warden.git'</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>库依赖项解析 － 当您使用的库存在依赖项时，
您需要特别注意它是怎么加载所依赖库的版本的（通过 $LOAD_PATH）。</p>

<h3 id="section">捆绑程序组</h3>

<p>完全支持组，使您可以先指定比如说 <code>development</code> 和 <code>test</code> 组，然后再从应用程序中将其去除。</p>

<p>示例 <code>Gemfile</code></p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"sinatra"</span>
<span class="n">gem</span> <span class="s2">"newrelic_rpm"</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vmc"</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>请注意，现在您可以设置环境变量 <code>BUNDLE_WITHOUT</code>，以去除开发和测试功能
另外还要注意，现在 Cloud Foundry 已能使用 <code>RAILS_ENV</code> 和 <code>RACK_ENV</code> 中设定的值</p>

<pre class="terminal">
vmc push --nostart

vmc env-add &lt;app_name&gt; RAILS_ENV=staging
vmc env-add &lt;app_name&gt; BUNDLE_WITHOUT=test:development

vmc start &lt;app_name&gt;

</pre>

<h3 id="section-1">平台</h3>

<p>现在已能支持所有平台，使您针对不同的操作系统选择不同的 gem。
下面是一个能使用各种平台的 <code>Gemfile</code> 示例：</p>

<pre><code class="language-ruby"><span class="c1"># Unix Rubies (OSX, Linux)</span>
<span class="n">platform</span> <span class="ss">:ruby</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rb-inotify'</span>
<span class="k">end</span>

<span class="c1"># Windows Rubies (RubyInstaller)</span>
<span class="n">platforms</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:mingw</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'eventmachine-win32'</span>
  <span class="n">gem</span> <span class="s1">'win32-changenotify'</span>
  <span class="n">gem</span> <span class="s1">'win32-event'</span>
<span class="k">end</span></code></pre>

<h2 id="rails-3">Rails 3</h2>

<p>一般来说，Rails 3 中包括对捆绑程序的“本机”支持。
新生成的 Rails 应用程序带有一个用户可编辑的 Gemfile，
并且 Rails 能在引导时自动激活该捆绑程序。
VCAP 一旦在应用程序中发现 <code>Gemfile.lock</code>，它会确保对所需 gem 进行打包，并设定指向它们的 <code>BUNDLE_PATH</code> 环境变量。</p>

<p>Rails 3 捆绑程序的支持限制 － 目前 VCAP 能很好地支持简单的 gem 依赖项列表（“gem install”所能找到的任何依赖项）。
但是，对于复杂的列表，或在部署时利用多个 repo 组装成的 gem 构建脚本，VCAP 的支持非常有限。
<strong>一般的做法是对应用程序进行最大程度的预打包处理。</strong></p>

<h2 id="rails-23">Rails 2.3</h2>

<p>Rails 的“config.gem”机制可供用户指定应用程序要运行的 gem 列表，
其局限性在于无法防止多重深度依赖项（利用其他 gem 的深层 gem）。
在云环境中，此问题容易引起故障。</p>

<p>为了降低风险，许多 Rails 2.3 已采用了 gem 捆绑程序。</p>

<p><strong>VCAP 目前不能“检测”Rails 2.3 应用程序。如果您需要运行
Ruby 2.3 应用程序，可将其伪装成 Rails 3 应用程序（通过创建一个 config/application.rb 文件和一个“config.ru”）。</strong></p>

<h2 id="section-2">应用程序服务器</h2>

<p>目前，该命令行和部署的云只能为 Sinatra 和 Rails 应用程序提供一个应用程序服务器： <code>Thin</code>.
但是，如果您使用的捆绑程序，并且捆绑程序中没有需要使用 Thin 的，VCAP 将无法安全地用它来启动应用程序。
此时，它会退回改用“rails server”运行您的应用程序，而“rails server”需使用 WEBrick。</p>

<p><strong>为了获得最佳性能和效果，我们建议在您的 Gemfile 中增加“gem ‘thin’”。</strong></p>

<h2 id="ruby-">Ruby 版本</h2>

<p>VCAP 支持两种 ruby“runtime”：</p>

<ul>
<li>ruby18：Ruby 版本 1.8.7-p302（或更高版本）</li>
  <li>ruby19：Ruby 版本 1.9.2-p180</li>
</ul><p><strong>默认 runtime 为 ruby18</strong>；您也可以在 vmc 命令行中用 <code>--runtime</code> 标志来指定：</p>

<pre class="terminal">
$ vmc push myapp --runtime ruby19
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://e.weibo.com/2169336083/profile' rel='external' target='_blank'>Weibo</a>
<a class='facebook replaced' href='http://cloudfoundry.csdn.net' rel='external' target='_blank'>CSDN</a>
<a class='youtube replaced' href='http://i.youku.com/u/id_UNDI5MTA2Mjk2' rel='external' target='_blank'>YouKu</a>
</div>
<div class='prepend-2 span-5'>
<p>
<!-- %a{:href => "#{url(@config, :www_app)}/faq"} 问题 -->
<a href='http://cndocs.cloudfoundry.com/faq.html'>问题</a>
|
<a href='http://forum.csdn.net/slist/cloudfoundry' rel='external'>论坛</a>
|
<!-- %a{:href => url(@config, :blog_app), :rel => "external"} 博客 -->
<a href='http://cnblog.cloudfoundry.com/' rel='external'>博客</a>
|
<a href='http://www.cloudfoundry.com/jobs'>工作</a>
|
<a href='http://www.cloudfoundry.com/legal'>法律</a>
|
<a href='http://www.cloudfoundry.com/terms'>条款</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>隐私</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2013 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-14']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    /$(document).ready(function() {
     / $('#social-share').dcSocialShare({
      /  buttonSize: 'horizontal',
      / buttons: 'facebook,twitter,plusone,linkedin',
      /  location: 'top',
      /  align: 'right',
      /  offsetLocation: 260,
      /  offsetAlign: 100,
      /  width: 80,
      /  center: true,
      /  centerPx: 600,
      /  disableFloat: true,
      /  tabText: '',
      /  twitterId: 'cloudfoundry'
      /});
    /});
  //]]>
</script>
</body>
</html>
